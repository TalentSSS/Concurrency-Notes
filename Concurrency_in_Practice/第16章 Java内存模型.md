## 第16章 Java内存模型

### 16.1 什么是内存模型，为什么需要它

会使线程无法看到变量最新值的原因

* 在编译器中生成的指令顺序，可以与源代码中的顺序不同
* 编译器还会把内存保存在寄存器中而不是内存中
* 处理器可以采用乱序或并行等方式来执行指令
* 缓存可能会改变写入变量提交到主内存的次序
* 而且，保存在处理器本地缓存中的值，对于其他处理器不可见。

Java语言规范要求JVM在线程中维护一种类似串行的语义：**只要程序最终结果与在严格串行环境中执行的结果相同，那么上述所有操作都是允许的**。

多线程环境中，维护程序的串行性将导致很大的性能开销。并发应用程序中的各个线程大部分时间都执行各自的任务，**线程之间的协调操作只会降低程序运行速度**。只有当多个线程要共享数据时，才必须协调它们之间的操作，并且JVM依赖程序通过同步操作来找出这些协调操作将在何时发生。

JMM规定了JVM必须遵循一组最小保证，这组保证规定了对变量的写入操作在何时将对其他线程可见。